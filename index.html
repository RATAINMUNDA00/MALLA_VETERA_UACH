<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Malla Medicina Veterinaria - UACh</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{
      --vet-green-700: #2e7d32; /* principal */
      --vet-green-900: #1b5e20;
      --card-bg: #ffffff;
      --muted: #556b2f;
      --ok: #c8e6c9;
      --locked: #f0f0f0;
      --accent: #e8f5e9;
      --shadow: 0 6px 18px rgba(0,0,0,0.06);
      --radius:10px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: "Inter", "Segoe UI", Arial, sans-serif;
      background:#f6faf6; /* tenue verdoso */
      color:#223322;
      -webkit-font-smoothing:antialiased;
    }
    header{
      display:flex;
      align-items:center;
      gap:18px;
      padding:16px 22px;
      background:linear-gradient(90deg,var(--vet-green-700), var(--vet-green-900));
      color:white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    }
    header img{
      height:64px;
      width:auto;
      display:block;
      border-radius:6px;
      background:white;
      padding:4px;
    }
    header h1{
      margin:0;
      font-size:18px;
      letter-spacing:0.4px;
      font-weight:700;
    }
    .wrapper{ padding:18px; }

    /* GRID that wraps horizontally into rows (no horizontal scroll) */
    .malla-container{
      width:100%;
      padding:12px 6px 32px;
      overflow-x:hidden; /* important: prevent horizontal scroll */
    }
    .malla{
      display:grid;
      grid-template-columns: repeat(5, minmax(240px, 1fr)); /* wraps into rows */
      gap:14px;
      align-items:start;
      max-width:1200px;
      margin:0 auto;
    }
    .col{
      background:var(--card-bg);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:10px;
      min-height:120px;
      display:flex;
      flex-direction:column;
    }
    .col h2{
      margin:0 0 8px;
      font-size:14px;
      background:var(--vet-green-700);
      color:white;
      padding:8px;
      border-radius:8px;
      text-align:center;
      font-weight:700;
    }
    .course{
      border-radius:8px;
      padding:8px;
      margin-bottom:8px;
      background:var(--accent);
      cursor:pointer;
      transition:transform .08s ease, box-shadow .08s ease, background .12s;
      font-size:13px;
      line-height:1.2;
      position:relative;
      border:1px solid rgba(34,51,34,0.06);
    }
    .course:hover{ transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.06); }
    .course .code{ font-weight:700; display:block; margin-bottom:4px; color:var(--vet-green-900); }
    .course .name{ display:block; color:#223322; font-size:13px; }
    .course .meta{ font-size:12px; color:var(--muted); margin-top:6px; }

    .course.completed{ background:var(--ok); text-decoration:line-through; color:#063d11; }
    .course.locked{ background:var(--locked); color: #8b8b8b; cursor:not-allowed; opacity:0.98; }

    /* tooltip */
    .tooltip {
      display:inline-block;
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      bottom: calc(100% + 8px);
      background:#222;
      color:white;
      padding:6px 8px;
      border-radius:6px;
      font-size:12px;
      white-space:nowrap;
      opacity:0;
      pointer-events:none;
      transition:opacity .12s;
      z-index:20;
    }
    .course:hover .tooltip { opacity:1; }

    /* legend */
    .legend{ display:flex; gap:12px; align-items:center; margin:10px 0 18px; flex-wrap:wrap; }
    .legend .item{ display:flex; gap:8px; align-items:center; font-size:13px; color:var(--muted); }
    .sw{ width:18px;height:14px;border-radius:4px;border:1px solid rgba(0,0,0,0.06) }
    .sw.ok{ background:var(--ok) }
    .sw.lock{ background:var(--locked) }
    .sw.free{ background:var(--accent) }

    .note{ font-size:13px; color:var(--muted); margin-top:8px; max-width:1200px; margin-left:auto; margin-right:auto; }

    /* responsive tweaks */
    @media (max-width:700px){ .malla{ grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); } header img{ height:48px; } }
  </style>
</head>
<body>
  <header>
    <!-- Coloca logo.png en la misma carpeta que este HTML para que se muestre -->
    <img src="logo.png" alt="Logo UACh (poner logo.png junto al HTML)">
    <h1>Malla Curricular - Medicina Veterinaria · Universidad Austral de Chile</h1>
  </header>

  <div class="wrapper">
    <div class="legend">
      <div class="item"><span class="sw free"></span> Pendiente</div>
      <div class="item"><span class="sw ok"></span> Aprobada</div>
      <div class="item"><span class="sw lock"></span> Bloqueada (falta requisito)</div>
    </div>

    <div class="malla-container">
      <div class="malla" id="malla"></div>
    </div>

    <div class="note">Haz clic en una asignatura para marcarla como aprobada / desmarcarla. El progreso se guarda en tu navegador (localStorage). Si no ves el logo, asegúrate de poner <code>logo.png</code> en la misma carpeta que este archivo.</div>
  </div>

  <script>
    const data = {
      1: [
        {code:"BIMI030", name:"BIOLOGÍA CELULAR", reqs:[]},
        {code:"CIAN040", name:"ZOOLOGÍA Y ECOLOGÍA APLICADA", reqs:[]},
        {code:"DYRE070", name:"EDUCACIÓN FÍSICA Y SALUD", reqs:[]},
        {code:"MATM003", name:"ELEMENTOS DE CÁLCULO", reqs:[]},
        {code:"MVET013", name:"PRÁCTICA INTRODUCCIÓN A LA MEDICINA VETERINARIA I", reqs:[]},
        {code:"PANI090", name:"CÓMO SE ESTUDIAN LOS PECES", reqs:[]},
        {code:"QUIM007", name:"QUÍMICA GENERAL", reqs:[]}
      ],
      2: [
        {code:"ANAV051", name:"ANATOMÍA VETERINARIA", reqs:[]},
        {code:"ANAV131", name:"EMBRIOLOGÍA VETERINARIA", reqs:[]},
        {code:"DYRE000", name:"ACONDICIONAMIENTO FÍSICO GENERAL", reqs:[]},
        {code:"FARM101", name:"BIOQUÍMICA VETERINARIA", reqs:["BIMI030"]},
        {code:"HIPA104", name:"HISTOLOGÍA", reqs:["BIMI030"]},
        {code:"MVET053", name:"PRÁCTICA INTRODUCCIÓN A LA MEDICINA VETERINARIA II", reqs:["MVET013"]}
      ],
      3: [
        {code:"ANAV140", name:"MORFOLOGÍA VETERINARIA APLICADA", reqs:["ANAV051"]},
        {code:"BIMI165", name:"MICROBIOLOGÍA GENERAL", reqs:["FARM101"]},
        {code:"CIAN141", name:"ZOOTECNIA", reqs:["CIAN040"]},
        {code:"FARM151", name:"FISIOLOGÍA VETERINARIA", reqs:["FARM101"]},
        {code:"FARM155", name:"INMUNOLOGÍA", reqs:["BIMI030"]},
        {code:"MEPR132", name:"BIOESTADÍSTICA", reqs:["MATM003"]}
      ],
      4: [
        {code:"CIAN113", name:"ETOLOGÍA Y BIENESTAR ANIMAL", reqs:["CIAN141"]},
        {code:"CIAN161", name:"FISIOLOGÍA REPRODUCTIVA", reqs:["ANAV131","ANAV140"]},
        {code:"CIDI023", name:"INGLÉS I", reqs:[]},
        {code:"FARM202", name:"FISIOPATOLOGÍA VETERINARIA", reqs:["FARM151"]},
        {code:"MEPR235", name:"ENFERMEDADES INFECCIOSAS DE LOS ANIMALES DOMÉSTICOS", reqs:["BIMI165"]},
        {code:"PANI142", name:"PATOLOGÍA GENERAL", reqs:["HIPA104","FARM155"]}
      ],
      5: [
        {code:"CIAN243", name:"NUTRICIÓN Y ALIMENTACIÓN", reqs:["CIAN141"]},
        {code:"CIAN262", name:"REPRODUCCIÓN ANIMAL I", reqs:["CIAN161"]},
        {code:"CIDI123", name:"INGLÉS II", reqs:["CIDI023"]},
        {code:"FARM211", name:"FARMACOLOGÍA VETERINARIA", reqs:["FARM202"]},
        {code:"MVET102", name:"PRÁCTICA BÁSICA", reqs:[
          "ANAV051","MEPR132","BIMI030","FARM101","DYRE070","MATM003","ANAV131","FARM151","HIPA104","FARM155",
          "BIMI165","ANAV140","PANI090","DYRE000","MVET013","MVET053","QUIM007","CIAN040","CIAN141","MEPR235",
          "CIAN113","CIAN161","FARM202","CIDI023","PANI142"
        ]},
        {code:"PANI238", name:"ENFERMEDADES PARASITARIAS", reqs:["FARM202","PANI142"]},
        {code:"PANI239", name:"PATOLOGÍA ESPECIAL E INMUNOPATOLOGÍA", reqs:["PANI142"]}
      ],
      6: [
        {code:"CIAN233", name:"REPRODUCCIÓN ANIMAL II", reqs:["CIAN161"]},
        {code:"CIAN240", name:"ECONOMÍA Y FUNDAMENTOS DE ADMINISTRACIÓN PECUARIA", reqs:["MEPR132"]},
        {code:"CIAN249", name:"PRODUCCIÓN DE NO RUMIANTES", reqs:["CIAN243"]},
        {code:"CIDI223", name:"INGLÉS III", reqs:["CIDI123"]},
        {code:"MEPR200", name:"EPIDEMIOLOGÍA VETERINARIA", reqs:[]},
        {code:"PANI253", name:"ACUICULTURA Y ENFERMEDADES DE PECES", reqs:["CIAN243","PANI239"]},
        {code:"PANI245", name:"ENFERMEDADES DE AVES", reqs:["PANI238","PANI239"]}
      ],
      7: [
        {code:"CIAN244", name:"GENÉTICA PECUARIA", reqs:["MEPR132","CIAN249"]},
        {code:"CIAN246", name:"PRODUCCIÓN DE RUMIANTES I", reqs:["CIAN243","CIAN262"]},
        {code:"ELECT100", name:"OPTATIVO DE ESPECIALIZACIÓN I", reqs:["ALL_SEM_1_7"]},
        {code:"HOVE215", name:"CIRUGÍA GENERAL Y ANESTESIOLOGÍA VETERINARIA", reqs:["FARM211"]},
        {code:"HOVE272", name:"EXPLORACIÓN CLÍNICA", reqs:["FARM202","PANI239"]},
        {code:"HOVE278", name:"MEDICINA INTERNA I", reqs:["FARM211","PANI239"]},
        {code:"MEPR209", name:"PRÁCTICA TRANSFERENCIA TECNOLÓGICA Y SERVICIO VETERINARIO A LA SOCIEDAD", reqs:["PANI238","MEPR200","MVET102"]}
      ],
      8: [
        {code:"CIAN235", name:"PRODUCTOS ANIMALES", reqs:["CIAN249","CIAN246"]},
        {code:"CIAN248", name:"PRODUCCIÓN DE RUMIANTES II", reqs:["CIAN240","CIAN246"]},
        {code:"ELECT101", name:"OPTATIVO DE ESPECIALIZACIÓN II", reqs:["ALL_SEM_1_7"]},
        {code:"HOVE279", name:"MÉTODOS COMPLEMENTARIOS DE DIAGNÓSTICO", reqs:["HOVE272"]},
        {code:"HOVE292", name:"MEDICINA INTERNA II", reqs:["PANI239"]},
        {code:"HOVE293", name:"PATOLOGÍA QUIRÚRGICA Y CIRUGÍA ESPECIAL", reqs:["HOVE215","HOVE272"]},
        {code:"MEPR216", name:"CONTROL SANITARIO E INOCUIDAD DE ALIMENTOS", reqs:["PANI238","MEPR200","PANI239"]}
      ],
      9: [
        {code:"CIAN255", name:"FORMULACIÓN Y EVALUACIÓN DE PROYECTOS", reqs:["CIAN248","CIAN235"]},
        {code:"ELECT12", name:"OPTATIVO DE PROFUNDIZACIÓN I", reqs:["ALL_SEM_1_7"]},
        {code:"HOVE294", name:"CLÍNICA DE RUMIANTES", reqs:["HOVE278","HOVE292","HOVE279","HOVE293"]},
        {code:"HOVE295", name:"CLÍNICA DE EQUINOS", reqs:["HOVE278","HOVE292","HOVE279","HOVE293"]},
        {code:"HOVE296", name:"CLÍNICA DE PEQUEÑOS ANIMALES", reqs:["HOVE278","HOVE293","HOVE279","HOVE293"]},
        {code:"MEPR210", name:"SALUD PÚBLICA VETERINARIA", reqs:["MEPR216"]}
      ],
      10: [
        {code:"ELECT116", name:"OPTATIVO DE PROFUNDIZACIÓN II", reqs:["ALL_SEM_1_7"]},
        {code:"HOVE297", name:"INTERNADO CLÍNICO", reqs:["HOVE295","HOVE296","HOVE294"]},
        {code:"MVET207", name:"PRÁCTICA PROFESIONAL DE INSPECCIÓN VETERINARIA DE ALIMENTOS", reqs:["MEPR216"]},
        {code:"MVET208", name:"PRÁCTICA PROFESIONAL", reqs:["ALL_SEM_1_7"]},
        {code:"MVET299", name:"PROYECTO DE TÍTULO (a)", reqs:["ALL_SEM_1_9"]}
      ]
    };

    const STORAGE_KEY = "malla-vet-uach";
    let state = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");

    function allSemRequiresSatisfied(token){
      const m = token.match(/^ALL_SEM_(\d)_(\d+)$/);
      if(!m) return false;
      const start = parseInt(m[1],10);
      const end = parseInt(m[2],10);
      const codes = [];
      for(let s=start;s<=end;s++){
        (data[s]||[]).forEach(c=>codes.push(c.code));
      }
      return codes.every(code => !!state[code]);
    }

    function isUnlocked(course){
      if(!course.reqs || course.reqs.length===0) return true;
      return course.reqs.every(r=>{
        if(typeof r === 'string' && r.startsWith("ALL_SEM_")) return allSemRequiresSatisfied(r);
        return !!state[r];
      });
    }

    function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

    function render(){
      const cont = document.getElementById("malla");
      cont.innerHTML = "";
      for(let s=1;s<=10;s++){
        const col = document.createElement("div"); col.className="col";
        const h = document.createElement("h2"); h.textContent = `${s}° SEMESTRE`; col.appendChild(h);

        const list = data[s] || [];
        if(list.length===0){
          const emp = document.createElement("div"); emp.style.color="#666"; emp.style.fontSize="13px"; emp.style.padding="6px"; emp.textContent = "Sin ramos"; col.appendChild(emp);
        } else {
          list.forEach(c=>{
            const d = document.createElement("div"); d.className = "course";
            const code = document.createElement("span"); code.className = "code"; code.textContent = c.code;
            const name = document.createElement("span"); name.className = "name"; name.textContent = c.name;
            d.appendChild(code); d.appendChild(name);

            const reqText = (c.reqs && c.reqs.length>0)
              ? c.reqs.map(r => {
                  if(typeof r === 'string' && r.startsWith("ALL_SEM_")){
                    const m = r.match(/^ALL_SEM_(\d)_(\d+)$/);
                    return m ? `Ramos desde ${m[1]}° a ${m[2]}° sem.` : r;
                  } else { return r; }
                }).join(", ")
              : "Sin requisitos";

            const tt = document.createElement("div"); tt.className="tooltip"; tt.textContent = "Requiere: " + reqText; d.appendChild(tt);

            if(state[c.code]) d.classList.add("completed");
            else if(!isUnlocked(c)) d.classList.add("locked");

            d.addEventListener("click", ()=>{
              if(!isUnlocked(c)) return;
              if(state[c.code]) delete state[c.code]; else state[c.code]=true;
              saveState(); render();
            });

            col.appendChild(d);
          });
        }
        cont.appendChild(col);
      }
    }

    render();
  </script>
</body>
</html>
